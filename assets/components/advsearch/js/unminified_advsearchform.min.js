/*
 * AdvSearch 1.0.0 - AjaxSearchForm
 * Copyright (c) 2011 Coroico - www.modx.wangba.fr
 *
 * Licensed under the GPL license: http://www.gnu.org/copyleft/gpl.html
 */

var advsea = new Array();
var ashw;
var ashws = 0;

 jQuery(function($) {

    function activateAs(asv) {
        p = asv.asid + '_';      // prefix for the instance

        if (asv.hid) {  // help requested
            hl = $('#'+p+'helplink');   // help link
            if (hl) hl.click(function() {
                pars={id: asv.hid};
                $.post('index.php',pars,function(text) {
                    if (!ashws) {
						ashw = window.open('','AdvSearch Help','height=500, width=600, top=10, left=10, toolbar=no, menubar=yes, location=no, resizable=yes, scrollbars=yes, status=no');
						ashw.document.write(text);
						ashw.onunload = function(){ashws = 0;}					
					}
                    if (window.focus) ashw.focus();
                    ashws = 1;
                    return false;
                });
                return false;
            });  //= adds the help function to the help link for click event
        }
        if (asv.cdt) {   // clear default requested
            var si = $('#'+p+'search');   // search input
            if (si) {
                si.attr('defaultValue',si.val());
                si.focus(function() {
                    if (this.value == this.defaultValue) this.value = '';  
                    return false;
                });
                si.blur(function() {
                    if (this.value == '' && this.defaultValue) {
						si.attr('defaultValue',asv.cdt); // after the first blur, the default value is reinitialized to default
						this.value = this.defaultValue; 
					}
                    return false;
                });
            }
        }
    }

    function activateAdvSearch() {
        for(ias=0;ias<advsea.length;ias++) { //= Each newSearch instance is activated
            asv = eval('(' + advsea[ias] + ')');
            activateAs(asv);
        }
    }

    activateAdvSearch(); //= as soon as the DOM is loaded
});